From 60a4700be4777dcd23025f8d774a7e20201ae7ef Mon Sep 17 00:00:00 2001
From: Claude <noreply@anthropic.com>
Date: Wed, 12 Nov 2025 23:00:38 +0000
Subject: [PATCH] =?UTF-8?q?Implementar=20modal=20de=20chapas=20del=20parte?=
 =?UTF-8?q?=20en=20Mi=20Contrataci=C3=B3n=20(Supabase)?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Funcionalidad: Modal con todas las chapas del parte agrupadas por puesto
- Query directo a Supabase
- Emojis por especialidad
- Dise√±o atractivo con n√∫meros naranjas
- Responsive y cerrable (X, click fuera, ESC)
- Resumen con desglose por puesto
---
 app.js     | 225 ++++++++++++++++++++++++++++++
 index.html |  24 ++++
 styles.css | 401 +++++++++++++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 650 insertions(+)

diff --git a/app.js b/app.js
index dc3b1be..1ca9880 100644
--- a/app.js
+++ b/app.js
@@ -1078,6 +1078,20 @@ async function loadContratacion() {
           card.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
         });
 
+        // Click para abrir modal con chapas del parte
+        card.addEventListener('click', () => {
+          if (jornal.parte) {
+            mostrarChapasDelParte({
+              parte: jornal.parte,
+              empresa: jornal.empresa,
+              buque: jornal.buque,
+              fecha: jornal.fecha,
+              jornada: jornal.jornada,
+              puesto: jornal.puesto
+            });
+          }
+        });
+
         cardsContainer.appendChild(card);
       });
 
@@ -1096,6 +1110,217 @@ async function loadContratacion() {
   }
 }
 
+/**
+ * Muestra el modal con todas las chapas contratadas en un parte espec√≠fico,
+ * agrupadas por puesto de contrataci√≥n (usando Supabase)
+ */
+async function mostrarChapasDelParte(parteInfo) {
+  const modal = document.getElementById('modal-chapas-parte');
+  const loading = document.getElementById('modal-chapas-loading');
+  const content = document.getElementById('modal-chapas-content');
+  const titulo = document.getElementById('modal-chapas-titulo');
+  const subtitulo = document.getElementById('modal-chapas-subtitulo');
+
+  if (!modal) return;
+
+  // Funci√≥n para obtener el emoji de un puesto
+  const getEmojiPuesto = (puesto) => {
+    const puestoLower = puesto.toLowerCase();
+    if (puestoLower.includes('conductor de 1')) return 'üöö';
+    if (puestoLower.includes('conductor de 2')) return 'üöó';
+    if (puestoLower.includes('trincador de coches') || puestoLower.includes('trincador de coche')) return 'üë∑';
+    if (puestoLower.includes('trincador')) return 'üë∑';
+    if (puestoLower.includes('especialista')) return 'üë∑';
+    return 'üë§'; // emoji por defecto
+  };
+
+  // Mostrar modal
+  modal.style.display = 'flex';
+  loading.classList.remove('hidden');
+  content.innerHTML = '';
+
+  // Actualizar t√≠tulo
+  titulo.textContent = `Parte ${parteInfo.parte}`;
+  subtitulo.textContent = `${parteInfo.empresa} ‚Ä¢ ${parteInfo.buque} ‚Ä¢ ${parteInfo.fecha} ‚Ä¢ ${parteInfo.jornada}`;
+
+  try {
+    console.log('üîç Buscando chapas para el parte:', parteInfo.parte);
+
+    // Obtener TODAS las chapas del parte desde Supabase
+    const { data: chapasDelParte, error } = await supabase
+      .from('jornales')
+      .select('*')
+      .eq('parte', parteInfo.parte)
+      .eq('fecha', parteInfo.fecha)
+      .eq('jornada', parteInfo.jornada);
+
+    if (error) {
+      throw error;
+    }
+
+    console.log(`‚úÖ ${chapasDelParte.length} chapas encontradas en el parte`);
+
+    loading.classList.add('hidden');
+
+    if (chapasDelParte.length === 0) {
+      content.innerHTML = `
+        <div class="modal-empty-state">
+          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
+            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
+          </svg>
+          <h3>No se encontraron chapas</h3>
+          <p>No hay chapas asignadas a este parte.</p>
+        </div>
+      `;
+      return;
+    }
+
+    // Agrupar por puesto de contrataci√≥n
+    const chapasPorPuesto = {};
+    chapasDelParte.forEach(jornal => {
+      const puesto = jornal.puesto || 'Sin puesto asignado';
+      if (!chapasPorPuesto[puesto]) {
+        chapasPorPuesto[puesto] = [];
+      }
+      chapasPorPuesto[puesto].push(jornal.chapa);
+    });
+
+    // Ordenar puestos alfab√©ticamente
+    const puestosOrdenados = Object.keys(chapasPorPuesto).sort();
+
+    // Renderizar grupos de puestos
+    puestosOrdenados.forEach(puesto => {
+      const chapas = chapasPorPuesto[puesto];
+
+      const puestoGroup = document.createElement('div');
+      puestoGroup.className = 'puesto-group';
+
+      const header = document.createElement('div');
+      header.className = 'puesto-group-header';
+      header.innerHTML = `
+        <h3 class="puesto-group-title">${getEmojiPuesto(puesto)} ${puesto}</h3>
+        <span class="puesto-group-count">${chapas.length} asignacion${chapas.length > 1 ? 'es' : ''}</span>
+      `;
+
+      const grid = document.createElement('div');
+      grid.className = 'chapas-grid';
+
+      // Ordenar chapas num√©ricamente
+      const chapasOrdenadas = chapas.sort((a, b) => {
+        const numA = parseInt(a) || 0;
+        const numB = parseInt(b) || 0;
+        return numA - numB;
+      });
+
+      chapasOrdenadas.forEach(chapa => {
+        const badge = document.createElement('div');
+        badge.className = 'chapa-badge';
+        badge.innerHTML = `
+          <div class="chapa-numero">${chapa}</div>
+          <div class="chapa-label">Chapa</div>
+        `;
+        grid.appendChild(badge);
+      });
+
+      puestoGroup.appendChild(header);
+      puestoGroup.appendChild(grid);
+      content.appendChild(puestoGroup);
+    });
+
+    // Mostrar resumen total con desglose por puesto
+    const resumen = document.createElement('div');
+    resumen.className = 'modal-resumen-container';
+
+    // T√≠tulo del resumen
+    const resumenTitulo = document.createElement('div');
+    resumenTitulo.className = 'modal-resumen-titulo';
+    resumenTitulo.innerHTML = `
+      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
+        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
+      </svg>
+      <span>Resumen del Parte</span>
+    `;
+    resumen.appendChild(resumenTitulo);
+
+    // Grid de puestos con su cantidad
+    const resumenGrid = document.createElement('div');
+    resumenGrid.className = 'modal-resumen-grid';
+
+    puestosOrdenados.forEach(puesto => {
+      const cantidad = chapasPorPuesto[puesto].length;
+      const card = document.createElement('div');
+      card.className = 'modal-resumen-card';
+      card.innerHTML = `
+        <div class="modal-resumen-numero">${cantidad}</div>
+        <div class="modal-resumen-puesto">${getEmojiPuesto(puesto)} ${puesto}</div>
+      `;
+      resumenGrid.appendChild(card);
+    });
+
+    resumen.appendChild(resumenGrid);
+
+    // Total general
+    const totalGeneral = document.createElement('div');
+    totalGeneral.className = 'modal-resumen-total';
+    totalGeneral.innerHTML = `
+      <strong>Total:</strong> ${chapasDelParte.length} trabajador${chapasDelParte.length > 1 ? 'es' : ''}
+    `;
+    resumen.appendChild(totalGeneral);
+
+    content.appendChild(resumen);
+
+  } catch (error) {
+    console.error('Error al cargar chapas del parte:', error);
+    loading.classList.add('hidden');
+    content.innerHTML = `
+      <div class="modal-empty-state">
+        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
+          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
+        </svg>
+        <h3>Error al cargar datos</h3>
+        <p>No se pudieron cargar las chapas del parte. Por favor, intenta de nuevo.</p>
+      </div>
+    `;
+  }
+}
+
+/**
+ * Cierra el modal de chapas del parte
+ */
+function cerrarModalChapas() {
+  const modal = document.getElementById('modal-chapas-parte');
+  if (modal) {
+    modal.style.display = 'none';
+  }
+}
+
+// Event listeners para el modal
+document.addEventListener('DOMContentLoaded', () => {
+  const modal = document.getElementById('modal-chapas-parte');
+  const closeBtn = document.getElementById('modal-chapas-close');
+
+  // Cerrar con bot√≥n X
+  if (closeBtn) {
+    closeBtn.addEventListener('click', cerrarModalChapas);
+  }
+
+  // Cerrar al hacer click fuera del modal
+  if (modal) {
+    modal.addEventListener('click', (e) => {
+      if (e.target === modal) {
+        cerrarModalChapas();
+      }
+    });
+  }
+
+  // Cerrar con tecla ESC
+  document.addEventListener('keydown', (e) => {
+    if (e.key === 'Escape') {
+      cerrarModalChapas();
+    }
+  });
+});
+
 /**
  * Carga la p√°gina de jornales - Sistema de Quincenas
  * Agrupa jornales por per√≠odos quincenales (1-15, 16-fin de mes)
diff --git a/index.html b/index.html
index 302b054..5e41325 100644
--- a/index.html
+++ b/index.html
@@ -453,6 +453,30 @@
 
   </main>
 
+  <!-- MODAL - CHAPAS DEL PARTE -->
+  <div id="modal-chapas-parte" class="modal-overlay" style="display: none;">
+    <div class="modal-container">
+      <div class="modal-header">
+        <div>
+          <h2 id="modal-chapas-titulo">Chapas contratadas en el parte</h2>
+          <p id="modal-chapas-subtitulo" style="color: #ffffff; margin-top: 0.5rem; font-size: 0.9rem;"></p>
+        </div>
+        <button id="modal-chapas-close" class="modal-close-btn" aria-label="Cerrar">
+          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
+            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
+          </svg>
+        </button>
+      </div>
+      <div class="modal-body">
+        <div id="modal-chapas-loading" class="loading-state">
+          <div class="spinner"></div>
+          <p>Cargando chapas...</p>
+        </div>
+        <div id="modal-chapas-content"></div>
+      </div>
+    </div>
+  </div>
+
   <!-- Modal para cambiar contrase√±a -->
   <div id="change-password-modal" class="modal-overlay" style="display: none;">
     <div class="modal-content">
diff --git a/styles.css b/styles.css
index ce843d3..380d9a5 100644
--- a/styles.css
+++ b/styles.css
@@ -2194,3 +2194,404 @@ body::before {
     height: 20px;
   }
 }
+
+/* ========================================
+   MODAL - CHAPAS DEL PARTE
+   ======================================== */
+
+.modal-overlay {
+  position: fixed;
+  top: 0;
+  left: 0;
+  width: 100%;
+  height: 100%;
+  background: rgba(0, 0, 0, 0.6);
+  backdrop-filter: blur(4px);
+  z-index: 10000;
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  padding: 1rem;
+  animation: fadeIn 0.2s ease-out;
+}
+
+@keyframes fadeIn {
+  from {
+    opacity: 0;
+  }
+  to {
+    opacity: 1;
+  }
+}
+
+.modal-container {
+  background: white;
+  border-radius: 24px;
+  width: 100%;
+  max-width: 1200px;
+  max-height: 90vh;
+  display: flex;
+  flex-direction: column;
+  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
+  animation: slideUp 0.3s ease-out;
+  overflow: hidden;
+}
+
+@keyframes slideUp {
+  from {
+    opacity: 0;
+    transform: translateY(30px);
+  }
+  to {
+    opacity: 1;
+    transform: translateY(0);
+  }
+}
+
+.modal-header {
+  padding: 1.5rem 2rem;
+  border-bottom: 2px solid var(--border-color);
+  background: #0a2e5c !important;
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  gap: 1rem;
+}
+
+.modal-header h2 {
+  margin: 0;
+  color: #ffffff !important;
+  font-size: 1.5rem;
+  font-weight: 700;
+  opacity: 1 !important;
+  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
+}
+
+.modal-header p {
+  color: #ffffff !important;
+  opacity: 1 !important;
+}
+
+.modal-header * {
+  color: #ffffff !important;
+  opacity: 1 !important;
+}
+
+.modal-close-btn {
+  background: rgba(255, 255, 255, 0.2);
+  border: none;
+  width: 40px;
+  height: 40px;
+  border-radius: 50%;
+  display: flex;
+  align-items: center;
+  justify-content: center;
+  cursor: pointer;
+  transition: all 0.2s;
+  flex-shrink: 0;
+}
+
+.modal-close-btn:hover {
+  background: rgba(255, 255, 255, 0.3);
+  transform: rotate(90deg);
+}
+
+.modal-close-btn svg {
+  width: 24px;
+  height: 24px;
+  color: white;
+}
+
+.modal-body {
+  padding: 2rem;
+  overflow-y: auto;
+  flex: 1;
+}
+
+/* Grupos de puestos en el modal */
+.puesto-group {
+  margin-bottom: 2rem;
+  animation: fadeInUp 0.4s ease-out;
+}
+
+@keyframes fadeInUp {
+  from {
+    opacity: 0;
+    transform: translateY(20px);
+  }
+  to {
+    opacity: 1;
+    transform: translateY(0);
+  }
+}
+
+.puesto-group-header {
+  background: #0a2e5c !important;
+  color: white;
+  padding: 1rem 1.5rem;
+  border-radius: 12px;
+  margin-bottom: 1rem;
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+  box-shadow: 0 4px 12px rgba(10, 46, 92, 0.15);
+}
+
+.puesto-group-header * {
+  opacity: 1 !important;
+}
+
+.puesto-group-title {
+  font-size: 1.25rem;
+  font-weight: 700;
+  margin: 0;
+  color: #ffffff !important;
+  opacity: 1 !important;
+  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
+}
+
+.puesto-group-count {
+  background: var(--puerto-orange);
+  color: white;
+  padding: 0.375rem 0.875rem;
+  border-radius: 20px;
+  font-size: 0.875rem;
+  font-weight: 600;
+}
+
+.chapas-grid {
+  display: grid;
+  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
+  gap: 1rem;
+}
+
+.chapa-badge {
+  background: white;
+  border: 2px solid var(--border-color);
+  border-radius: 12px;
+  padding: 1rem;
+  text-align: center;
+  transition: all 0.2s;
+  cursor: default;
+  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
+}
+
+.chapa-badge:hover {
+  transform: translateY(-4px);
+  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
+  border-color: var(--puerto-blue);
+}
+
+.chapa-numero {
+  font-size: 1.5rem;
+  font-weight: 700;
+  color: var(--puerto-orange);
+  margin-bottom: 0.25rem;
+}
+
+.chapa-label {
+  font-size: 0.75rem;
+  color: var(--text-secondary);
+  text-transform: uppercase;
+  letter-spacing: 0.5px;
+}
+
+/* Estado vac√≠o en modal */
+.modal-empty-state {
+  text-align: center;
+  padding: 3rem 1rem;
+  color: var(--text-secondary);
+}
+
+.modal-empty-state svg {
+  width: 64px;
+  height: 64px;
+  color: var(--border-color);
+  margin-bottom: 1rem;
+}
+
+.modal-empty-state h3 {
+  color: var(--puerto-dark-blue);
+  margin-bottom: 0.5rem;
+}
+
+/* Responsive modal */
+@media (max-width: 768px) {
+  .modal-container {
+    max-width: 100%;
+    max-height: 95vh;
+    border-radius: 16px;
+  }
+
+  .modal-header {
+    padding: 1rem 1.5rem;
+  }
+
+  .modal-header h2 {
+    font-size: 1.25rem;
+  }
+
+  .modal-body {
+    padding: 1.5rem;
+  }
+
+  .chapas-grid {
+    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
+    gap: 0.75rem;
+  }
+
+  .chapa-badge {
+    padding: 0.75rem;
+  }
+
+  .chapa-numero {
+    font-size: 1.25rem;
+  }
+
+  .puesto-group-header {
+    padding: 0.875rem 1.25rem;
+    flex-direction: column;
+    align-items: flex-start;
+    gap: 0.5rem;
+  }
+
+  .puesto-group-title {
+    font-size: 1.1rem;
+  }
+}
+
+/* Cursor pointer para las tarjetas de contrataci√≥n */
+.contratacion-card {
+  cursor: pointer;
+  user-select: none;
+}
+
+.contratacion-card:active {
+  transform: translateY(-2px) scale(0.98) !important;
+}
+
+/* ========================================
+   RESUMEN DEL MODAL - DESGLOSE POR PUESTO
+   ======================================== */
+
+.modal-resumen-container {
+  margin-top: 2.5rem;
+  padding: 0;
+  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
+  border-radius: 16px;
+  border: 2px solid var(--puerto-blue);
+  overflow: hidden;
+  box-shadow: 0 4px 16px rgba(10, 46, 92, 0.1);
+}
+
+.modal-resumen-titulo {
+  background: #0a2e5c !important;
+  color: #ffffff !important;
+  padding: 1rem 1.5rem;
+  display: flex;
+  align-items: center;
+  gap: 0.75rem;
+  font-size: 1.1rem;
+  font-weight: 700;
+  border-bottom: 2px solid rgba(255, 255, 255, 0.2);
+}
+
+.modal-resumen-titulo * {
+  opacity: 1 !important;
+}
+
+.modal-resumen-titulo span {
+  color: #ffffff !important;
+  opacity: 1 !important;
+  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
+}
+
+.modal-resumen-titulo svg {
+  width: 24px;
+  height: 24px;
+  flex-shrink: 0;
+  color: #ffffff !important;
+  opacity: 1 !important;
+}
+
+.modal-resumen-grid {
+  display: grid;
+  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
+  gap: 1rem;
+  padding: 1.5rem;
+}
+
+.modal-resumen-card {
+  background: white;
+  border-radius: 12px;
+  padding: 1.25rem;
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+  gap: 0.5rem;
+  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
+  border: 2px solid var(--border-color);
+  transition: all 0.2s;
+}
+
+.modal-resumen-card:hover {
+  transform: translateY(-2px);
+  box-shadow: 0 4px 16px rgba(10, 46, 92, 0.15);
+  border-color: var(--puerto-blue);
+}
+
+.modal-resumen-numero {
+  font-size: 2.5rem;
+  font-weight: 700;
+  color: var(--puerto-orange);
+  line-height: 1;
+}
+
+.modal-resumen-puesto {
+  font-size: 0.9rem;
+  color: var(--puerto-dark-blue);
+  text-align: center;
+  font-weight: 600;
+  line-height: 1.3;
+}
+
+.modal-resumen-total {
+  background: linear-gradient(135deg, var(--puerto-green), #27ae60);
+  color: white;
+  padding: 1rem 1.5rem;
+  text-align: center;
+  font-size: 1.1rem;
+  font-weight: 600;
+  border-top: 2px solid rgba(255, 255, 255, 0.2);
+}
+
+/* Responsive para resumen */
+@media (max-width: 768px) {
+  .modal-resumen-grid {
+    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
+    gap: 0.75rem;
+    padding: 1rem;
+  }
+
+  .modal-resumen-card {
+    padding: 1rem;
+  }
+
+  .modal-resumen-numero {
+    font-size: 2rem;
+  }
+
+  .modal-resumen-puesto {
+    font-size: 0.85rem;
+  }
+
+  .modal-resumen-titulo {
+    font-size: 1rem;
+    padding: 0.875rem 1.25rem;
+  }
+
+  .modal-resumen-total {
+    font-size: 1rem;
+    padding: 0.875rem 1.25rem;
+  }
+}
-- 
2.43.0

